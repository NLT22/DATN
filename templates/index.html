<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Há»‡ thá»‘ng khÃ³a cá»­a thÃ´ng minh</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="text-center mb-5">ğŸ” Há»‡ thá»‘ng khÃ³a cá»­a thÃ´ng minh</h1>

    <div class="row g-4">
      <!-- Camera stream -->
      <div class="col-lg-6">
        <div class="card shadow">
          <div class="card-header bg-dark text-white">
            ğŸ“¹ Camera an ninh
          </div>
          <div class="card-body text-center">
            <img src="{{ url_for('video_feed') }}" alt="Video Stream" class="img-fluid rounded border border-dark">
          </div>
        </div>
      </div>

      <!-- Identity & Status -->
      <div class="col-lg-6 d-flex flex-column gap-4">
        <!-- Identity -->
        <div class="card shadow">
          <div class="card-header bg-primary text-white">
            ğŸš¹ Danh tÃ­nh nháº­n diá»‡n Ä‘Æ°á»£c
          </div>
          <div class="card-body text-center">
            <img id="recognized-image" src="/recognized_identity_image/0" alt="Recognized Face" class="img-fluid rounded border border-success">
          </div>
        </div>

        <!-- Status -->
        <div class="card shadow text-center">
          <div class="card-header bg-info text-white">
            Tráº¡ng thÃ¡i cá»­a
          </div>
          <div class="card-body">
            <h3 id="doorStatus" class="fw-bold text-secondary">ÄÃ³ng cá»­a</h3>
            <div class="d-flex justify-content-center gap-3 mt-4">
              <a href="{{ url_for('traffic_monitor') }}" class="btn btn-outline-secondary">ğŸ“‹ Nháº­t kÃ½ truy cáº­p</a>
              <a href="{{ url_for('add_user') }}" class="btn btn-outline-primary">â¬†ï¸ ThÃªm thÃ nh viÃªn</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JS for SSE updates -->
  <script>
    const evtSource = new EventSource("/sse/updates");

    evtSource.addEventListener("user", function(event) {
      const userId = parseInt(event.data);
      const imgEl = document.getElementById("recognized-image");
      if (imgEl) {
        imgEl.src = `/recognized_identity_image/${userId}?t=${Date.now()}`; // cache-busting
      }
    });

    evtSource.addEventListener("door", function(event) {
      const doorStatus = event.data;
      const statusEl = document.getElementById("doorStatus");
      if (statusEl) {
        statusEl.textContent = doorStatus === 'OPEN' ? 'ğŸšª Má»Ÿ cá»­a' : 'ğŸ”’ ÄÃ³ng cá»­a';
        statusEl.className = doorStatus === 'OPEN'
          ? 'fw-bold text-success'
          : 'fw-bold text-danger';
      }
    });
  </script>
</body>
</html>
