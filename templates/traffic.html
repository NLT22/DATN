<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Access Log</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">
  <div class="container mt-5">
    <h2 class="mb-4 text-center">üìã Door Access Log</h2>

    <!-- Filter Form -->
    <form method="GET" action="{{ url_for('traffic_monitor') }}" class="card p-3 shadow-sm mb-4">
        <div class="row g-3 align-items-end">
            <div class="col-md-3">
            <label class="form-label">T√™n th√†nh vi√™n</label>
            <input type="text" name="name" class="form-control" placeholder="e.g. Trung" value="{{ request.args.get('name', '') }}">
            </div>
            <div class="col-md-2">
            <label class="form-label">T·ª´ ng√†y</label>
            <input type="date" name="start_date" class="form-control" value="{{ request.args.get('start_date', '') }}">
            </div>
            <div class="col-md-2">
            <label class="form-label">ƒê·∫øn ng√†y</label>
            <input type="date" name="end_date" class="form-control" value="{{ request.args.get('end_date', '') }}">
            </div>
            <div class="col-md-5">
            <label class="form-label d-block">L·ªçc theo</label>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="group_by" value="day" id="filterDay" {% if request.args.get('group_by', 'day') == 'day' %}checked{% endif %}>
                <label class="form-check-label" for="filterDay">Ng√†y</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="group_by" value="week" id="filterWeek" {% if request.args.get('group_by') == 'week' %}checked{% endif %}>
                <label class="form-check-label" for="filterWeek">Tu·∫ßn</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="group_by" value="month" id="filterMonth" {% if request.args.get('group_by') == 'month' %}checked{% endif %}>
                <label class="form-check-label" for="filterMonth">Th√°ng</label>
            </div>
            </div>
        </div>

        <!-- Submit button in a separate row, full width -->
        <div class="row mt-3">
        <div class="col-12">
            <button type="submit" class="btn btn-primary w-100">üîç L·ªçc</button>
        </div>
        </div>
    </form>

    
    <!-- Chart Section -->
    <div class="card shadow-sm mt-0 p-4">
      <h5 class="mb-4 text-center">üìä Th·ªëng k√™ l∆∞·ª£t truy c·∫≠p</h5>
      <canvas id="accessChart" height="100"></canvas>
    </div>

    <!-- Access Logs Table -->
    <div class="card shadow-sm mt-4 p-4">
      {% if logs %}
        <div class="table-responsive">
          <table class="table table-bordered table-striped table-hover">
            <thead class="table-primary">
              <tr>
                <th>#</th>
                <th>T√™n th√†nh vi√™n</th>
                <th>Vai tr√≤</th>
                <th>Th·ªùi gian</th>
                <th>K·∫øt qu·∫£</th>
              </tr>
            </thead>
            <tbody>
              {% for log in logs %}
              <tr>
                <td>{{ loop.index }}</td>
                <td>{{ log.name }}</td>
                <td>{{ log.role }}</td>
                <td>{{ log.access_time }}</td>
                <td>
                  {% if log.result == 'success' %}
                    <span class="badge bg-success">Th√†nh c√¥ng</span>
                  {% else %}
                    <span class="badge bg-danger">T·ª´ ch·ªëi</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-muted text-center">Kh√¥ng c√≥ b·∫£n ghi truy c·∫≠p n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc.</p>
      {% endif %}

      <div class="text-end mt-3">
        <a href="{{ url_for('index') }}" class="btn btn-primary">‚óÄÔ∏è Quay l·∫°i trang ch·ªß</a>
      </div>
    </div>


  </div>

  <script>
    const ctx = document.getElementById('accessChart').getContext('2d');
    const accessChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: {{ chart_labels|tojson }},
        datasets: [{
          label: 'S·ªë l∆∞·ª£t truy c·∫≠p',
          data: {{ chart_counts|tojson }},
          backgroundColor: 'rgba(54, 162, 235, 0.7)',
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          x: { title: { display: true, text: 'Th·ªùi gian' }},
          y: {
            beginAtZero: true,
            title: { display: true, text: 'S·ªë l∆∞·ª£t' }
          }
        }
      }
    });
  </script>
</body>
</html>
